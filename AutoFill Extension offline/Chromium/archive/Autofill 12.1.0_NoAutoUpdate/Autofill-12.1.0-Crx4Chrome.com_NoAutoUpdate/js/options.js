/*!
 * Based on TableDnD by Denis Howlett
 * https://isocra.com/
 * Modified by T. H. Doan
 */
var e=null;function t(t){if(e&&e.dragObject){var n=t.pageY-e.mouseOffset.y;if(n!==e.oldY){var i=n>e.oldY;e.oldY=n;var s=e.findDropTargetRow(n-(Le.fluid?e.oldScrollTop-e.scrollObject.scrollTop:0));s&&(i&&e.dragObject!==s?(e.dragObject.parentNode.insertBefore(e.dragObject,s.nextSibling),t.pageY+e.dragObject.clientHeight>(Le.fluid?e.edgeBottom:H+e.scrollObject.scrollTop)?e.timer||(e.timer=setInterval((function(){e.scrollObject.scrollBy(0,40),e.scrollObject.scrollTop===e.maxScrollTop&&(clearInterval(e.timer),e.timer=null)}),50)):(clearInterval(e.timer),e.timer=null)):i||e.dragObject===s||(e.dragObject.parentNode.insertBefore(e.dragObject,s),t.pageY<(Le.fluid?e.edgeTop:e.scrollObject.scrollTop)?e.timer||(e.timer=setInterval((function(){e.scrollObject.scrollBy(0,-40),e.scrollObject.scrollTop||(clearInterval(e.timer),e.timer=null)}),50)):(clearInterval(e.timer),e.timer=null)))}}return!1}function n(t){e&&e.dragObject&&(We.body.classList.remove("dragging"),e.dragObject.classList.remove("selected"),e.dragObject=null,clearInterval(e.timer),e.timer=null,e=null,mt("fields")?oErr.refresh():Et(!1,!1),We.onmousemove=We.onmouseup=null)}function i(){this.dragObject=null,this.mouseOffset=null,this.table=null,this.oldY=0,this.scrollObject=Le.fluid?j:We.documentElement,this.timer=null,this.init=function(e){this.table=e;for(var t=e.tBodies[0].rows,n=1;n<t.length;++n)this.makeDraggable(t[n])},this.getPosition=function(e){for(var t=0,n=0;e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t+=e.offsetLeft,y:n+=e.offsetTop}},this.makeDraggable=function(i){if(i){var s=this;i.onmousedown=function(i){var o=i.target;return"TEXTAREA"===o.nodeName||"INPUT"===o.nodeName||"SELECT"===o.nodeName||"BUTTON"===o.nodeName||((e=s).dragObject=this,e.mouseOffset={y:i.pageY-e.getPosition(this).y},e.maxScrollTop=e.scrollObject.scrollHeight-(Le.fluid?e.scrollObject.offsetHeight:H),Le.fluid&&(e.edgeTop=P.offsetTop,e.edgeBottom=We.getElementById("content-actionbar").offsetTop,e.oldScrollTop=e.scrollObject.scrollTop),We.body.classList.add("dragging"),e.dragObject.classList.add("selected"),We.onmousemove=t,We.onmouseup=n,!1)}}},this.findDropTargetRow=function(e){for(var t=this.table.tBodies[0].rows,n=1;n<t.length;++n){var i=t[n],s=this.getPosition(i).y,o=parseInt(i.offsetHeight)/2;if(0===i.offsetHeight&&(s=this.getPosition(i.firstChild).y,o=parseInt(i.firstChild.offsetHeight)/2),e>s-o&&e<s+o)return i}return null}}
/*!
 * Based on Fading JavaScript Tooltips 2kb by Michael Leigeber
 * https://www.leigeber.com/
 * Modified by T. H. Doan
 */var s,o,a,l=(a=0,{show:function(t){e||((s=window.innerWidth)-r>7&&We.body.classList.add("no-scroll"),$e.innerHTML=t,$e.style.display="block",o=$e.offsetWidth,$e.style.visibility="visible",clearInterval($e.t),$e.t=setInterval((function(){l.fade(1)}),20))},pos:function(e){var t=e.pageX;$e.style.top=e.pageY+18+"px",$e.style.right=(t+o<s?s-t-o:0)+"px"},fade:function(e){if(95!==a&&1===e||0!==a&&-1===e){var t=10;95-a<10&&1===e?t=95-a:a<10&&-1===e&&(t=a),a+=t*e,$e.style.opacity=.01*a}else clearInterval($e.t),-1===e&&($e.style.display="none",$e.style.visibility="hidden",$e.innerHTML="",$e.style.top="",$e.style.right="",We.body.classList.remove("no-scroll"))},hide:function(){clearInterval($e.t),$e.t=setInterval((function(){l.fade(-1)}),20)}});
/*!
 * @package Autofill
 * @author T. H. Doan
 * @copyright (c) 2010-2023
 * @link https://www.tohodo.com/
 */Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(){});var r,c,d,u,f,g,v,h,m,p,b,y,E,k,I,x,w,M,B,L,T,O,N,C,S,_,P,j,D,R,A,V,J,F,U,$,q,Y,K,W,z,X,G,Z,Q,ee,te,ne,ie,se,oe,ae,le,re,ce,de,ue,fe,ge,ve,he,me,pe,be,ye,Ee,ke,Ie,xe,we,Me,Be,Le,Te,Oe,Ne,Ce,Se,_e,Pe,je,He,De,Re,Ae,Ve,Je,Fe,Ue,$e,qe,Ye,Ke,We=document,ze=chrome.runtime.getManifest(),Xe="Backup - ",Ge=ze.name,Ze=ze.version,Qe=["fields","advanced","exceptions","textclips","variables"],et={t:["Text","Password","Select","Checkbox/Radio","JavaScript"],o:["Safe","Overwrite","Prepend","Append","Wrap","Increment","Decrement"]},tt={},nt=!1,it=[],st="0 1px 6px #333",ot=new Event("change"),at=function(){return 18===Object.keys(Be).length},lt=function(){return C.classList.contains("search")},rt=function(){return C.classList.contains("results")},ct=navigator.userAgent.toLowerCase(),dt=ct.indexOf("firefox")>-1,ut=ct.indexOf("mac")>-1,ft=ut?"⌥":"Alt",gt=Cn((function(e){var t="";e.ctrlKey&&(t+="Ctrl + "),e.shiftKey&&(t+="Shift + "),e.altKey&&(t+=ft+" + "),e.metaKey&&(t+=(ut?"⌘":"Win")+" + "),t&&"Shift + "!==t&&(X.value=t,X.modifier=t)})),vt="rgb(255, 199, 206)",ht={msg:chrome.i18n.getMessage("statusFieldError")},mt=function(e){return ht[e].indexOf(1)>-1};function pt(e){return(e.nodeValue||"").trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}function bt(e){e&&e.target&&(e=this.id.slice(4)),e!==We.body.id&&(location.hash=e,We.body.id=e,Ct(),setTimeout((function(){switch(e){case"advanced":ke.focus();break;case"exceptions":Ie.focus();break;case"importexport":He.focus();break;case"news":x.classList.contains("news-flash")&&(localStorage.news=S.textContent),x.classList.remove("news-flash");break;case"textclips":xe.focus();break;case"variables":we.focus()}}),50),at()||(window.onbeforeunload=function(e){return e.preventDefault(),e.returnValue=""}))}function yt(e){return e=(e=e.replace(/[\r\n]{2,}/g,"\n")).replace(/^\s+|\s+$/gm,"")}function Et(e,t){if(void 0===e||void 0===t){var n=0===Object.keys(tt).length;ee.disabled=n,te.disabled=n}else ee.disabled=e,te.disabled=t;rt()&&(Z.disabled=!0)}function kt(){r=We.body.offsetWidth,c=window.innerHeight,Ct(),Ue.style.maxHeight=c-60+"px"}function It(e){return e.replace(/"/g,"&quot;")}function xt(){fetch("https://cdn.jsdelivr.net/gh/tohodo/autofill@main/news-update.md",{cache:"no-cache"}).then((function(e){e.ok?e.text().then((function(e){if(S){S.innerHTML=DOMPurify.sanitize(snarkdown(e)),S.querySelectorAll("a").forEach((function(e){e.target="_blank"}));for(var t,n=We.createTreeWalker(S,NodeFilter.SHOW_TEXT,{acceptNode:pt});t=n.nextNode();){var i=t.nodeValue||"";i=(i=(i=(i=i.replace(/([a-z])'([a-z])/gi,"$1’$2")).replace(/"(.+?)"/g,"“$1”")).replace(/--/g,"—")).replace(/ - /g," – "),t.nodeValue=i}"news"!==We.body.id&&S.textContent!==localStorage.news&&x.classList.add("news-flash")}})):console.error("["+Ge+"] "+chrome.i18n.getMessage("statusNewsError")+(e.status?" ("+e.status+")":""))})).catch((function(e){}))}function wt(){Tt();for(var e=0;e<Qe.length;++e)Mt(Qe[e])}function Mt(e){var t="string"!=typeof e;chrome.storage.local.get((function(n){if(chrome.runtime.lastError)console.error("["+Ge+"] There was a problem loading the data.");else{if(t&&(Be=n.o,Le=n.other,r=We.body.offsetWidth,c=window.innerHeight,We.getElementById("nav"),h=We.getElementById("nav-fields"),m=We.getElementById("nav-advanced"),p=We.getElementById("nav-exceptions"),b=We.getElementById("nav-textclips"),y=We.getElementById("nav-variables"),E=We.getElementById("nav-importexport"),k=We.getElementById("nav-other"),I=We.getElementById("nav-support"),x=We.getElementById("nav-news"),w=We.getElementById("nav-hotkey"),M=We.getElementById("nav-datasize"),B=We.getElementById("nav-whatsnew"),L=We.getElementById("help-name"),T=We.getElementById("help-value"),O=We.getElementById("help-site"),N=We.getElementById("help-mode"),Z=We.getElementById("button-add"),Q=We.getElementById("button-search"),ee=We.getElementById("button-save"),te=We.getElementById("button-reset"),ne=We.getElementById("button-help"),ie=We.getElementById("button-import"),se=We.getElementById("button-export"),oe=We.getElementById("button-importurl"),C=We.getElementById("tab-fields"),S=We.getElementById("tab-news"),_=We.getElementById("col-action"),P=We.getElementById("content-fields"),j=We.getElementById("content-fields-body"),Y=We.getElementById("content-searchbox"),K=We.getElementById("content-cats"),z=We.getElementById("content-site"),X=We.getElementById("content-hotkey"),ke=We.getElementById("content-advanced"),Ie=We.getElementById("content-exceptions"),xe=We.getElementById("content-textclips"),we=We.getElementById("content-variables"),He=We.getElementById("content-ie"),De=We.getElementById("radio-append"),Re=We.getElementById("content-importurl"),Te={activecat:We.getElementById("content-activecat"),attributesoff:We.getElementById("content-attributesoff"),autoimport:We.getElementById("content-autoimport"),backup:We.getElementById("content-backup"),badge:We.getElementById("content-badge"),closeinfobar:We.getElementById("content-closeinfobar"),debug:We.getElementById("content-debug"),delay:We.getElementById("content-delay"),filtercats:We.getElementById("content-filtercats"),fluid:We.getElementById("content-fluid"),hidebackup:We.getElementById("content-hidebackup"),manual:We.getElementById("content-manual"),mask:We.getElementById("content-mask"),menu:We.getElementById("content-menu"),overwrite:We.getElementById("content-overwrite"),sitefilters:We.getElementById("content-sitefilters"),skiphidden:We.getElementById("content-skiphidden"),sound:We.getElementById("content-sound"),vars:We.getElementById("content-vars"),voice:We.getElementById("content-voice")},Oe=We.getElementById("content-attributesoff-list"),Ne=We.getElementById("content-backup-chars"),Ce=We.getElementById("content-closeinfobar-sel"),Se=We.getElementById("content-delay-sec"),_e=We.getElementById("content-delay-out"),Pe=We.getElementById("content-sitefilters-sel"),je=We.getElementById("content-voice-sel"),Ae=We.getElementById("status"),Ve=Ae.getElementsByTagName("span")[0],Fe=We.getElementById("light"),Ue=We.getElementById("box"),$e=We.getElementById("tt"),ht.isOn=function(){return Ve.textContent.length&&Ve.style.background===vt},ht.refresh=function(){for(var e,t=1;t<P.rows.length;++t)e=P.rows[t].id.slice(2),ht.fields[t]=We.getElementById("n_"+e).style.background||We.getElementById("v_"+e).style.background||We.getElementById("s_"+e).style.background?1:"";mt("fields")||Pt()},e=location.hash.slice(1),We.getElementById("tab-"+e)&&bt(e),function(e,t){for(var n,i,s=e.split("."),o=t.split("."),a=0;a<o.length;++a){if((n=~~o[a])>(i=~~s[a]))return!0;if(n<i)return!1}return!1}(n.ver||"1.0.0",Ze)&&(jt(),Dt({ver:Ze})),function(){if(!w)return;var e=dt?"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox":"chrome://extensions/shortcuts";w.href=e,w.onclick=function(t){t.preventDefault(),chrome.tabs.create({url:e})}}(),n.search&&(C.classList.add("search"),Y.value.trim()&&setTimeout((function(){Y.dispatchEvent(new Event("input"))}),0)),Ct(),We.body.style.visibility="visible"),ht.isOn()&&Pt(),("fields"===e||t)&&(ht.fields=[],Y.value="",R=n.cats,V=n.catcount,F=U=n.catnow,d=JSON.parse(n.rules),f=n.rulecount,on(),Ut(K.value),delete tt[e]),"cats"===e||t){var i=F<3;z.disabled=i,X.disabled=i,i?z.value=X.value="":(z.value=R[F-5].s||"",X.value=R[F-5].h||"",X.hotkey=X.value,(Ye=0===K[K.selectedIndex].text.indexOf(Xe))&&(z.disabled=X.disabled=!0))}if(("advanced"===e||t)&&(pe=n.advanced,ke.value=pe.join("\n"),delete tt[e]),("exceptions"===e||t)&&(be=n.exceptions,Ie.value=be.join("\n"),delete tt[e]),("textclips"===e||t)&&(ye=n.textclips,xe.placeholder=chrome.i18n.getMessage("optionsTextClipsPlaceholder"),xe.value=ye.join("\n===\n"),delete tt[e]),("variables"===e||t)&&(Ee=n.variables,we.value=Ee.join("\n"),delete tt[e]),Et(),t){for(var s in At(),B.textContent="v"+Ze,We.getElementById("yearnow").textContent=(new Date).getFullYear(),K.options[3].text=chrome.i18n.getMessage("optionsProfilesMenuManage"),Te)Te[s]&&(Te[s].checked=Le[s],Te[s].addEventListener("click",Nt));Oe.disabled=!Te.attributesoff.checked,Oe.value=n.attributesoff||"",Ne.disabled=!Te.backup.checked,Ne.value=n.backup,Ce.disabled=!Te.closeinfobar.checked,Ce.selectedIndex=n.closeinfobar,Se.disabled=!Te.delay.checked,Se.value=n.delay,_e.textContent=Se.value,Pe.disabled=!Te.sitefilters.checked,Pe.selectedIndex=n.sitefilters,je.disabled=!Te.voice.checked,je.selectedIndex=n.voice,Re.value=n.autoimport||"",Ue.addEventListener("keydown",Jt),h.addEventListener("click",bt),m.addEventListener("click",bt),p.addEventListener("click",bt),b.addEventListener("click",bt),y.addEventListener("click",bt),E.addEventListener("click",bt),k.addEventListener("click",bt),I.addEventListener("click",bt),x.addEventListener("click",bt),B.addEventListener("click",jt),L.addEventListener("mouseover",(function(){l.show(chrome.i18n.getMessage("optionsFieldsNameColTooltip"))})),L.addEventListener("mouseout",(function(){l.hide()})),T.addEventListener("mouseover",(function(){l.show(chrome.i18n.getMessage("optionsFieldsValueColTooltip"))})),T.addEventListener("mouseout",(function(){l.hide()})),O.addEventListener("mouseover",(function(){l.show(chrome.i18n.getMessage("optionsFieldsSiteColTooltip"))})),O.addEventListener("mouseout",(function(){l.hide()})),N.addEventListener("mouseover",(function(){l.show(chrome.i18n.getMessage("optionsFieldsModeColTooltip"))})),N.addEventListener("mouseout",(function(){l.hide()})),Z.addEventListener("click",(function(){Ft(f++,0,"","","",Le.overwrite,K[F].value)})),Q.addEventListener("click",nn),Y.addEventListener("input",Cn(tn)),ee.addEventListener("click",Ot),te.addEventListener("click",wt),ne.addEventListener("click",Bt),ie.addEventListener("click",In),se.addEventListener("click",wn),oe.addEventListener("click",xn),K.addEventListener("change",sn),z.addEventListener("change",(function(){Nt("cats")})),ke.addEventListener("keyup",Rt),Ie.addEventListener("keyup",Rt),xe.addEventListener("keyup",Rt),we.addEventListener("keyup",Rt),Oe.addEventListener("input",(function(){Nt("attributesoff")})),Ne.addEventListener("input",(function(){Nt("backup")})),Ce.addEventListener("change",(function(){Nt("closeinfobar")})),Se.addEventListener("input",(function(){Nt("delay")})),Pe.addEventListener("change",(function(){Nt("sitefilters")})),je.addEventListener("change",(function(){Nt("voice")})),Re.addEventListener("change",(function(){Nt("autoimport")})),Fe.addEventListener("click",_t),Ue.addEventListener("click",(function(e){e.stopPropagation()})),X.addEventListener("blur",_n),X.addEventListener("keyup",Sn),X.addEventListener("keydown",gt),j.addEventListener("change",Mn,!0),j.addEventListener("click",Bn,!0),j.addEventListener("focus",Ln,!0),j.addEventListener("keydown",Tn,!0),j.addEventListener("keyup",On,!0),j.addEventListener("mouseover",Nn),window.addEventListener("resize",kt)}}}))}function Bt(){open("https://www.tohodo.com/autofill/help.html#"+We.body.id,"AutofillHelp")}function Lt(e,t){return[].slice.call((t||We).querySelectorAll(e))}function Tt(){Y.focus(),Y.dispatchEvent(new Event("input"))}function Ot(){if(!ht.isOn())for(var e=0;e<Qe.length;++e)Nt(Qe[e])}function Nt(e,t){if(e.target){if(!this.id||0!==this.id.indexOf("content-"))return;e=this.id.slice(8)}switch(e){case"advanced":if(mt("fields"))return;ke.value=yt(ke.value),pe=ke.value?ke.value.split("\n"):[];for(var n=0;n<pe.length;++n)pe[n]=pe[n].replace(/ *: */,": ").replace(/ *= */g,"=").replace(/ {2,}/g," "),/^[cr]\d+:/.test(pe[n])||pe.splice(n,1);ke.value=pe.join("\n"),Dt({advanced:pe}).then((function(){Et(!0,!0),delete tt[e]}));break;case"cats":R.length?F>4&&(R[F-5].s=z.value=Vt(z.value)?z.value.trim():""):F=U=Math.min(F,2),Dt({catcount:V,catnow:U,cats:R}),Le.menu&&chrome.runtime.sendMessage({type:"buildMenu",data:{catnow:U,cats:R}});break;case"exceptions":if(mt("fields"))return;Ie.value=yt(Ie.value),be=Ie.value?Ie.value.split("\n"):[];for(n=0;n<be.length;++n)Vt(be[n])||(be.splice(n,1),--n);Ie.value=be.join("\n"),Dt({exceptions:be}).then((function(){Et(!0,!0),delete tt[e]}));break;case"fields":var s=K[F]&&K[F].value||K.value,o=0,a=Lt("tr[id]",j);for(n=0;n<a.length;++n)Zt(a[n].id.slice(2))||++o;if(o>0)return;if(rt()){for(n=0;n<it.length;++n)delete d["r"+it[n]];it=[]}else for(var n in d)"all"!==s&&s!==d[n].c||delete d[n];for(n=0;n<a.length;++n)St(a[n]);on(),Dt({o:Be,rulecount:f,rules:JSON.stringify(d)}).then((function(){Et(!0,!0),delete tt[e]})),chrome.storage.local.get("cats",(function(e){chrome.runtime.lastError||R.length===e.cats.length&&JSON.stringify(R)===JSON.stringify(e.cats)||Nt("cats")}));break;case"search":Dt({search:lt()});break;case"textclips":if(mt("fields"))return;xe.value=xe.value.replace(/\r\n/g,"\n").replace(/^(===)$/gm,"\n$1\n"),ye=xe.value?xe.value.split("\n===\n").filter(String):[];for(n=0;n<ye.length;++n)0===n?ye[n]=ye[n].replace(/\n$/,""):n===ye.length-1?ye[n]=ye[n].replace(/^\n/,""):ye[n]=ye[n].replace(/^\n|\n$/g,""),ye[n].split(/\n+/).filter(String).length<2&&(ye.splice(n,1),--n);xe.value=ye.join("\n===\n"),Dt({textclips:ye}).then((function(){Le.menu&&chrome.runtime.sendMessage({type:"buildMenu",data:{catnow:U,cats:R}})})).then((function(){Et(!0,!0),delete tt[e]}));break;case"variables":if(mt("fields"))return;we.value=yt(we.value).replace(/^.+?= */gm,(function(e){return e.replace(/ *= */,"").replace(/\W+/g,"_")+" = "})),Dt({variables:Ee=we.value?we.value.split("\n"):[]}).then((function(){Et(!0,!0),delete tt[e]}));break;default:switch(Te[e]&&(Le[e]=+Te[e].checked),e){case"attributesoff":Oe.disabled=!Te[e].checked,Oe.value=Oe.value.trim(),Dt({attributesoff:Oe.value});break;case"autoimport":Re.value=Re.value.trim(),Re.value&&!/^(https?|file):\/\/[\w~!@#%&=+|;:,./?-]+[\w~@#%&=+|/-]/.test(Re.value)&&(Pt(chrome.i18n.getMessage("statusInvalidUrl"),1),setTimeout(Pt,4e3)),ht.isOn()||Dt({autoimport:Re.value});break;case"backup":Ne.disabled=!Te[e].checked,Ne.value=Math.max(Math.min(1e4,+Ne.value),1),Dt({backup:+Ne.value});break;case"closeinfobar":Ce.disabled=!Te[e].checked,Dt({closeinfobar:Ce.selectedIndex});break;case"delay":window.event&&"input"===window.event.type&&(_e.textContent=Se.value),Se.disabled=!Te[e].checked,Dt({delay:+Se.value});break;case"fluid":(qe=new i).init(P);break;case"hidebackup":on(),Ut(K.value);break;case"mask":(We.getElementById("n_"+D).value||We.getElementById("v_"+D).value)&&Nt("fields"),Ut(K.value),ht.refresh();break;case"menu":Le[e]?chrome.runtime.sendMessage({type:"buildMenu",data:{catnow:U,cats:R}}):chrome.contextMenus.removeAll();break;case"sitefilters":Pe.disabled=!Te[e].checked,Dt({sitefilters:Pe.selectedIndex});break;case"sub":Me.value=Me.value.trim(),Dt({e:Me.value});case"vars":Mt("fields");break;case"voice":je.disabled=!Te[e].checked,Dt({voice:je.selectedIndex})}ht.isOn()||Dt({other:Le})}t||ht.isOn()||Pt(chrome.i18n.getMessage("statusOptionsSaved"),0)}function Ct(){var e;We.body.classList.toggle("fluid-table",Le.fluid),[j,ke,Ie,xe,we,He].forEach((function(t){null!==t.offsetParent&&(Le.fluid?(e="textarea"===t.type?0:10,t.style.height=Math.max(t.offsetHeight+c-We.body.scrollHeight-1,62+e)+"px"):t.removeAttribute("style"))}))}function St(e,t){var n=e.id.slice(2),i=We.getElementById("n_"+n),s=i.value.trim().replace(/\s*[\r\n]+\s*/g,"\n"),o=We.getElementById("s_"+n),a=yt(o.value);if(!a)for(var l=0;l<R.length;++l)if(R[l].k===e.cat){a=R[l].s;break}void 0===t&&(t=e.cat);for(l=0;l<R.length;++l)if(R[l].k===t){t&&R[l].s===a&&(a="");break}i.value=s,o.value=a,d["r"+n]={t:We.getElementById("t_"+n).selectedIndex,n:s,v:We.getElementById("v_"+n).value,s:a,o:We.getElementById("o_"+n).selectedIndex,c:t}}function _t(e,t,n,i){if(!e||"string"!=typeof e){if(clearTimeout(Ue.timer),ht.isOn()&&Ve.textContent!==ht.msg)return;var s=j.querySelector("tr.selected");return s&&s.classList.remove("selected"),Ue.style.display="none",Ue.textContent="",Fe.style.backgroundColor="rgba(0,0,0,0)",Ae.firstChild.style.boxShadow=st,void setTimeout((function(){Fe.style.display="none"}),400)}i?Ue.className=i:Ue.removeAttribute("class"),Ue.innerHTML=(t?"<header><h2>"+t+"</h2></header>":"")+e+'<footer><button id="button-close">'+chrome.i18n.getMessage(void 0===n?"buttonsClose":"buttonsCancel")+"</button>"+(n||"")+"</footer>",Fe.style.display="flex",setTimeout((function(){Fe.style.backgroundColor="rgba(0,0,0,0.8)"}),50),Ue.style.maxHeight=c-60+"px",Ae.firstChild.style.boxShadow=st,ae=We.getElementById("button-close"),Ue.timer=setTimeout((function(){Ue.style.display="block",Ue.scrollTop>0&&(Ue.scrollTop=0),Je=Lt("a[href],button,input,select",Ue),We.getElementById("changelog")?ae.focus():Je[0]&&Je[0].focus()}),250),ae.addEventListener("click",_t,{once:!0})}function Pt(e,t,n){if(!e)return clearTimeout(Ae.timer),Ae.style.webkitTransform="translateY(-150%)",void(Ae.timer=setTimeout((function(){Ae.style.display="none",Ve.style.background="",Ve.innerHTML=""}),400));switch(clearTimeout(Ae.timer),Ve.style.background=1===t?vt:"#c6efce",Ve.innerHTML=e,Ae.style.display="block",setTimeout((function(){Ae.style.webkitTransform="inherit"}),2===t?0:50),t){case 0:Ae.timer=setTimeout((function(){Ae.style.webkitTransform="translateY(-150%)",setTimeout((function(){mt("fields")?(Ve.style.background=vt,Ve.innerHTML=ht.msg,Ae.style.webkitTransform="inherit"):(Ae.style.display="none",Ve.innerHTML="")}),400)}),4e3);break;case 1:n&&Et(!0,!1)}}function jt(){_t('<figure class="spinner" aria-busy="true" role="alert"><figcaption>'+chrome.i18n.getMessage("statusLoading")+"</figcaption></figure>",void 0,void 0,"changelog loading"),fetch("https://www.tohodo.com/autofill/changelog.txt",{cache:"no-cache"}).then((function(e){e.ok?e.text().then((function(e){var t=DOMPurify.sanitize(e);t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;");var n=new RegExp("("+Ze+"[\\s\\S]+?)\n\n"),i=t.match(n);_t(t=i?'<h3 id="changelog">'+chrome.i18n.getMessage("generalWhatsNew").replace("__VER__",Ze)+"</h3><pre>"+i[1]+'</pre><h4><a href="https://www.tohodo.com/autofill/changelog.txt" target="_blank">'+chrome.i18n.getMessage("generalVerHistory")+"</a> &raquo;</h4>":"<pre>"+t+"</pre>",void 0,void 0,"changelog")})):console.error("["+Ge+"] "+chrome.i18n.getMessage("statusChangelogError")+(e.status?" ("+e.status+")":""))})).catch((function(e){console.error("["+Ge+"] "+chrome.i18n.getMessage("statusRequestError")+" ("+e+")")}))}function Ht(e,t){var n=e.n.toLowerCase(),i=t.n.toLowerCase();return n<i?-1:n>i?1:0}function Dt(e){return new Promise((function(t,n){chrome.storage.local.set(e,(function(){var e=chrome.runtime.lastError;e?(console.error("["+Ge+"] "+e.message),n(e.message)):(At(),t())}))}))}function Rt(){switch(We.body.id){case"advanced":this.value===pe.join("\n")?delete tt[We.body.id]:tt[We.body.id]=!0;break;case"exceptions":this.value===be.join("\n")?delete tt[We.body.id]:tt[We.body.id]=!0;break;case"textclips":this.value===ye.join("\n===\n")?delete tt[We.body.id]:tt[We.body.id]=!0;break;case"variables":this.value===Ee.join("\n")?delete tt[We.body.id]:tt[We.body.id]=!0}Et()}function At(){var e=function(e){M.innerHTML=chrome.i18n.getMessage("generalData")+": "+(e+"").replace(/(\d)(?=(\d{3})+$)/g,"$1,")};chrome.storage.local.getBytesInUse?chrome.storage.local.getBytesInUse((function(t){chrome.runtime.lastError||e(t)})):chrome.storage.local.get((function(t){chrome.runtime.lastError||e(JSON.stringify(t).length)}))}function Vt(e){try{return new RegExp(e.replace(/\n/g,"|")),!0}catch(e){return!1}}function Jt(e){if("Tab"===e.key){var t=Je.filter((function(e){return!e.disabled}));e.shiftKey?We.activeElement===t[0]&&(e.preventDefault(),t[t.length-1].focus()):We.activeElement===t[t.length-1]&&(e.preventDefault(),t[0].focus())}}function Ft(e,t,n,i,s,o,a,l){if(!D||n||i||d["r"+e]||Zt(D)){var r,c;if(1===F||l)if("all"!==a&&a){for(var u=0;u<R.length;++u)if(a===R[u].k){r=R[u].n,c=R[u].s;break}}else r=chrome.i18n.getMessage("optionsProfilesMenuUnfiled"),c="";if(l)if(-1===[et.t[t],n,i,s,et.o[o],r,c].join(" ").toLowerCase().indexOf(l.toLowerCase()))return;var g=P.insertRow(-1),v=g.insertCell(0),h=g.insertCell(1),m=g.insertCell(2),p=g.insertCell(3),b=g.insertCell(4),y=g.insertCell(5),E=e+'" rows="1" spellcheck="false">';g.id="r_"+e,g.cat=a&&"all"!==a?a:"",v.innerHTML=Yt("t",e,t),v.col="t",Le.vars&&(h.title="ID: n"+e),h.innerHTML="<textarea"+(4===t?" disabled":"")+' id="n_'+E+n+"</textarea>",Le.vars&&(m.title="ID: v"+e),m.innerHTML=0===t||4===t?'<textarea id="v_'+E+i+"</textarea>"+zt(e):'<input id="v_'+e+'"'+(1===t&&Le.mask?' type="password"':"")+' value="'+It(i)+'">',p.innerHTML='<textarea id="s_'+E+s+"</textarea>",b.innerHTML=Yt("o",e,o,t>1),b.col="o",y.innerHTML='<button id="d_'+e+'" title="'+chrome.i18n.getMessage("removeRuleTT")+'">&ndash;</button><button id="m_'+e+'" title="'+chrome.i18n.getMessage("moveRuleTT")+(r?"\n"+chrome.i18n.getMessage("optionsProfileTT")+": "+r+"\nID: "+a:"")+'">'+(r?"<span>"+r+"</span> ":"")+"&rsaquo;</button>",y.title=chrome.i18n.getMessage("reorderRuleTT"),We.getElementById("t_"+e).selectedIndex=t,We.getElementById("o_"+e).selectedIndex=o,n||i||d["r"+e]||(We.getElementById("n_"+e).focus(),qe&&qe.init(P),Et(!1,!1),tt.fields=!0,++Be.k),D=+e}else--f}function Ut(e){var t=[];if(Le.hidebackup)for(var n=0;n<R.length;++n)0===R[n].n.indexOf(Xe)&&t.push(R[n].k);for(P.classList.toggle("view-all",1===F);P.rows.length>1;)P.deleteRow(-1);for(var n in d)"all"!==e&&e!==d[n].c||Le.hidebackup&&!(t.indexOf(d[n].c)<0)||Ft(n.slice(1),d[n].t,d[n].n,d[n].v,d[n].s,d[n].o,d[n].c);C.classList.remove("results"),_.innerHTML="&nbsp;",it=[],qe||(qe=new i),qe.init(P)}function $t(e){var t=e.rowIndex;ht.fields.splice(e.rowIndex,1),e.remove(),mt("fields")?Et(!0,!1):(Et(!1,!1),tt.fields=!0,Pt()),D=+P.rows[P.rows.length-1].id.slice(2);var n=P.rows[t]||P.rows[t-1];0===n.id.indexOf("r_")&&n.querySelector("div").focus(),rt()&&it.push(e.id.slice(2)),--Be.k}function qt(e,t){"TEXTAREA"===e.nodeName&&(t?e.clientHeight<e.scrollHeight?setTimeout((function(){e.rows=Math.min(Math.round(e.scrollHeight/16),10),10===e.rows&&(e.style.overflow="auto"),e.scrollIntoViewIfNeeded()}),100):(window.event&&"Backspace"===window.event.key&&e.rows>1&&(e.rows=1,e.rows=Math.min(Math.round(e.scrollHeight/16),10)),e.scrollIntoViewIfNeeded()):e.rows>1&&!nt&&setTimeout((function(){e.style.overflow="hidden",e.rows=1}),100))}function Yt(e,t,n,i){return et[e]?'<div id="'+e+"_"+t+'" tabindex="0"'+(i?' class="disabled"':"")+">"+et[e][n]+"</div>":""}function Kt(e,t){if(!rt())switch(t.key){case"ArrowDown":if(t.altKey)(i=We.getElementById("r_"+e.id.slice(2))).nextSibling&&(nt=!0,e.readOnly=!0,i.parentNode.insertBefore(i,i.nextSibling.nextSibling),nt=!1,mt("fields")?ht.refresh():(Et(!1,!1),tt.fields=!0),e.focus());else if(e.parentNode.parentNode.nextSibling&&("textarea"!==e.type||e.selectionEnd-e.selectionStart===e.value.length||e.selectionStart===e.value.length)){t.preventDefault();var n=We.getElementById(e.id.slice(0,1)+"_"+e.parentNode.parentNode.nextSibling.id.slice(2));setTimeout((function(){qt(e,0)}),100),n.focus(),n.select()}break;case"ArrowUp":var i;if(t.altKey)(i=We.getElementById("r_"+e.id.slice(2))).rowIndex>1&&(nt=!0,e.readOnly=!0,i.parentNode.insertBefore(i,i.previousSibling),nt=!1,mt("fields")?ht.refresh():(Et(!1,!1),tt.fields=!0),e.focus());else if(e.parentNode.parentNode.previousSibling.id&&("textarea"!==e.type||e.selectionEnd-e.selectionStart===e.value.length||0===e.selectionStart)){t.preventDefault();n=We.getElementById(e.id.slice(0,1)+"_"+e.parentNode.parentNode.previousSibling.id.slice(2));setTimeout((function(){qt(e,0)}),100),n.focus(),n.select()}}}function Wt(e,t,n){var i=We.getElementById("r_"+e);if(St(i,t),F>1)i.parentNode.removeChild(i);else{var s=We.getElementById("m_"+e);s.firstChild.textContent=n,s.title=chrome.i18n.getMessage("optionsProfileTT")+": "+n+"\n"+chrome.i18n.getMessage("moveRuleTT"),i.cat=t}Dt({rulecount:f,rules:JSON.stringify(d)}).then((function(){_t(),ht.isOn()||(on(K.selectedIndex),Et(!0,!0),delete tt.fields,Pt(chrome.i18n.getMessage("statusRuleMoved").replace(/___/,n),0))}))}function zt(e){return'<button id="e_'+e+'" class="badge" title="'+chrome.i18n.getMessage("buttonsEditTT")+'">'+chrome.i18n.getMessage("buttonsEdit")+"</button>"}function Xt(e){if("disabled"!==e.className){var t=e.id.slice(0,1),n=e.id.slice(2);if(et[t]&&t===e.parentNode.col){Gt();for(var i='<select id="'+t+"_"+n+'">',s=0;s<et[t].length;++s)i+="<option"+(s===e.selectedIndex?" selected":"")+">"+et[t][s]+"</option>";return i+="</select>",e.outerHTML=i,(e=We.getElementById(t+"_"+n)).onblur=Gt,e.onmouseout=Gt,e}}}function Gt(e){if(!e||null!==e.relatedTarget)for(var t=Lt("select",j),n=0;n<t.length;++n){var i=t[n].id.slice(0,1),s=t[n].id.slice(2),o=t[n].selectedIndex;t[n].onblur=null,t[n].outerHTML=Yt(i,s,o),We.getElementById(i+"_"+s).selectedIndex=o}}function Zt(e,t,n){if(P.rows.length>1&&(mt("fields")||!t||d["r"+e]&&t.value!==d["r"+e][t.id.slice(0,1)])){var i,s=d["r"+e],o=We.getElementById("r_"+e),a=o.rowIndex,l=We.getElementById("t_"+e).selectedIndex,r=We.getElementById("n_"+e),c=We.getElementById("v_"+e),u=We.getElementById("s_"+e),f=We.getElementById("o_"+e),g=We.getElementById("m_"+e),v=n&&"click"===n.type,h=function(){return r.style.background||c.style.background||u.style.background};if(n&&"change"===n.type&&(o.childNodes[2].innerHTML=0===l||4===l?'<textarea id="v_'+e+'" rows="1">'+c.value+"</textarea>"+zt(e):'<input id="v_'+e+'"'+(1===l&&Le.mask?' type="password"':"")+' value="'+It(c.value)+'">',c=We.getElementById("v_"+e),4===l?(r.oldValue=r.value,r.value="",r.disabled=!0):(r.value||(r.value=r.oldValue||""),r.disabled=!1),f.selectedIndex>4?(c.oldValue=c.value,c.value="",c.disabled=!0):(c.value||(c.value=c.oldValue||""),c.disabled=!1),f.classList.toggle("disabled",l>1||0===g.textContent.indexOf(Xe)),r.disabled?c.focus():r.focus(),!s&&!mt("fields")))return;if(Vt(r.value)?Vt(u.value)?r.value||c.value?h()&&(r.style.background=c.style.background=u.style.background="",ht.fields[a]="",i="",mt("fields")||Pt()):(u.style.background="",1===l||r.disabled?(r.style.background="",c.style.background=vt,c.focus()):(r.style.background=vt,r.focus()),ht.fields[a]=1):(u.style.background=vt,u.focus(),ht.fields[a]=1,i=chrome.i18n.getMessage("statusInvalidRegex")):(r.style.background=vt,r.focus(),ht.fields[a]=1,i=chrome.i18n.getMessage("statusInvalidRegex")),h()||mt("fields")){if(Pt(i||ht.msg,1,"fields"),ht.fields[a])g.disabled=!0;else if(v)return!0;return!1}v||(Et(!1,!1),tt.fields=!0),g.disabled=!1,ht.isOn()&&Pt()}return!0}function Qt(){_t("<p>"+chrome.i18n.getMessage("statusUnsavedChanges")+"</p>",chrome.i18n.getMessage("optionsFieldsConfirmation"),'<button id="button-discard" data-catnow="'+K.selectedIndex+'">'+chrome.i18n.getMessage("buttonsDiscardContinue")+"</button>")}function en(e){for(var t="<p>"+chrome.i18n.getMessage("optionsFieldsSelectProfile")+'</p><p><select id="select-cat"><option value="">'+chrome.i18n.getMessage("optionsProfilesMenuUnfiled")+"</option>",n=0;n<R.length;++n)t+='<option value="'+R[n].k+'"'+(R[n].k===e.cat?" selected":"")+(0===R[n].n.indexOf(Xe)?" hidden":"")+">"+R[n].n+"</option>";t+='<option value="new" class="menu-action">'+chrome.i18n.getMessage("optionsProfilesMenuNew")+"</option></select></p>",e.classList.add("selected"),_t(t,chrome.i18n.getMessage("optionsFieldsMove"),"");var i=e.id.slice(2),s=We.getElementById("select-cat"),o=0===s.selectedIndex?2:s.selectedIndex+4,a=function(e){void 0===e&&(e="");var t=(prompt(chrome.i18n.getMessage("promptProfileName")+":",e||"")||"").trim();if(un(t,a)){var n="c"+V++;R.push({k:n,n:t,s:We.getElementById("s_"+i).value||z.value}),Wt(i,n,t),Nt("cats")}else s.selectedIndex=o-4};s.addEventListener("change",(function(){"new"===this.value?a():Wt(i,this.value,this.options[this.selectedIndex].text)}))}function tn(){var e=[Z,K,z,X],t=this&&this.value&&this.value.trim();if(t){if(tt.fields)return Qt(),ae.addEventListener("click",(function(){Y.value="",Y.focus()}),{once:!0}),void We.getElementById("button-discard").addEventListener("click",(function(){delete tt.fields,ht.fields=[],Pt(),_t(),Tt(),Et()}),{once:!0});C.classList.add("results");for(var n=0;n<e.length;++n)e[n].disabled=!0;for(P.classList.add("view-all");P.rows.length>1;)P.deleteRow(-1);for(var n in d)Ft(n.slice(1),d[n].t,d[n].n,d[n].v,d[n].s,d[n].o,d[n].c,t);var i=Lt("tr[id]",j).length;_.innerHTML=i+" result"+(1===i?"":"s")}else if(rt()){K.dispatchEvent(new Event("change"));for(n=0;n<e.length;++n)e[n].disabled=!1}}function nn(){C.classList.toggle("search"),Ct(),lt()?Tt():tn(),Nt("search",!0)}function sn(e){var t=K[K.selectedIndex].text;if(Ye=0===t.indexOf(Xe),e instanceof Event){if(0===t.indexOf("——"))return void(K.selectedIndex=F);if(0===t.indexOf(chrome.i18n.getMessage("optionsProfilesMenuManage")))return void dn();if(tt.fields)return Qt(),K.selectedIndex=F,void We.getElementById("button-discard").addEventListener("click",(function(){sn(+this.getAttribute("data-catnow")),_t(),Et(),Pt()}),{once:!0});F=K.selectedIndex,Ye||(U=F),Ut(K.value),chrome.storage.local.get("catnow",(function(e){chrome.runtime.lastError||(Le.menu&&!Ye&&chrome.runtime.sendMessage({type:"updateCatMenu",data:{catnow:U}}),Dt({catnow:U}))}))}else F=e,Ye||(U=F),K.selectedIndex=e,chrome.storage.local.get("catnow",(function(e){chrome.runtime.lastError||(Le.menu&&!Ye&&R.length+4===K.length-1&&chrome.runtime.sendMessage({type:"updateCatMenu",data:{catnow:U}}),Dt({catnow:U}).then((function(){Mt("fields")})))}));Mt("cats"),an()}function on(e){var t=0,n=0;isNaN(e)&&(e=F),K.length=5;for(var i,s,o,a=0;a<R.length;++a){for(var l in(i=Le.hidebackup&&0===R[a].n.indexOf(Xe))||((s=We.createElement("option")).text=R[a].n,s.value=R[a].k),o=0,d)R[a].k===d[l].c&&(i?++n:++o);t+=o,i||(o>0&&(s.text+=" ("+o+")"),K.add(s))}v=Object.keys(d).length,K[1].text=chrome.i18n.getMessage("optionsProfilesMenuAll")+(v>0?" ("+(v-n)+")":""),K[2].text=chrome.i18n.getMessage("optionsProfilesMenuUnfiled")+(v>0?" ("+(v-t-n)+")":""),e>R.length+4&&Dt({catnow:e=F=U=2}),K.selectedIndex=e,an()}function an(){K.title=chrome.i18n.getMessage("selectProfileTT")+"\nID: "+K.value}function ln(e,t,n){for(var i in e)e[i].c===A[t].k&&(u["r"+g++]={t:e[i].t,n:e[i].n,v:e[i].v,s:e[i].s,o:e[i].o,c:n})}function rn(e){for(var t in e)if($.indexOf(e[t].c)>-1)delete e[t];else if(R.length)for(var n=0,i=R.length;n<i&&e[t].c!==R[n].k;++n)n===i-1&&(e[t].s||(e[t].s=G[e[t].c]||""),e[t].c="");else e[t].s||(e[t].s=G[e[t].c]||""),e[t].c=""}function cn(e,t){var n,i=We.createDocumentFragment();W.options.length=0;for(var s=0;s<A.length;++s)Le.hidebackup&&0===A[s].n.indexOf(Xe)||((n=i.appendChild(We.createElement("option"))).text=A[s].n,n.value=A[s].k,(Array.isArray(t)&&t.indexOf(s)>-1||A[s].k===t)&&(n.selected=!0));W.appendChild(i),e&&(W.changed=!0,W.dispatchEvent(ot))}function dn(){if(K.selectedIndex=F,tt.fields)return Qt(),void We.getElementById("button-discard").addEventListener("click",(function(){Mt("fields"),setTimeout(dn,100)}),{once:!0});var e='<p></p><select id="content-catlist" size="13" multiple></select><button id="button-new">'+chrome.i18n.getMessage("buttonsProfileNew")+'</button><br><button id="button-rename" disabled>'+chrome.i18n.getMessage("buttonsProfileRename")+'</button><br><button id="button-movefirst" disabled>'+chrome.i18n.getMessage("buttonsProfileMoveFirst")+'</button><br><button id="button-moveup" disabled>'+chrome.i18n.getMessage("buttonsProfileMoveUp")+'</button><br><button id="button-movedown" disabled>'+chrome.i18n.getMessage("buttonsProfileMoveDown")+'</button><br><button id="button-movelast" disabled>'+chrome.i18n.getMessage("buttonsProfileMoveLast")+'</button><br><button id="button-delete" disabled>'+chrome.i18n.getMessage("buttonsProfileDelete")+'</button><br><button id="button-duplicate" disabled>'+chrome.i18n.getMessage("buttonsProfileDuplicate")+'</button><br><button id="button-sort"'+(R.length<2?" disabled":"")+">"+chrome.i18n.getMessage("buttonsProfilesSort")+"</button><br><br>",t=R.length;for(u={},g=f,A=[],J=V,$=[],G={};t--;)A[t]=R[t];_t(e,chrome.i18n.getMessage("optionsProfilesManageProfiles"),'<button id="button-saveclose" disabled>'+chrome.i18n.getMessage("buttonsSaveClose")+"</button>"),W=We.getElementById("content-catlist"),le=We.getElementById("button-new"),re=We.getElementById("button-rename"),ce=We.getElementById("button-movefirst"),de=We.getElementById("button-moveup"),ue=We.getElementById("button-movedown"),fe=We.getElementById("button-movelast"),ge=We.getElementById("button-delete"),ve=We.getElementById("button-duplicate"),he=We.getElementById("button-sort"),me=We.getElementById("button-saveclose"),cn(),W.addEventListener("change",kn),le.addEventListener("click",fn),re.addEventListener("click",gn),ce.addEventListener("click",vn),de.addEventListener("click",hn),ue.addEventListener("click",mn),fe.addEventListener("click",pn),ge.addEventListener("click",bn),ve.addEventListener("click",yn),he.addEventListener("click",En),me.addEventListener("click",(function(){A&&function(){if(W.changed){if(R=A,V=J,rn(d),rn(u),R.length&&W.oldCat){F=U=2;for(var e=0;e<R.length;++e)if(R[e].k===W.oldCat){F=e+5,0!==R[e].n.indexOf(Xe)&&(U=F);break}}for(var e in u)d[e]=u[e];Dt({rulecount:f=Math.max(f,g),rules:JSON.stringify(d)}).then((function(){Nt("cats"),on();var e=K.querySelector('option[value="'+W.newCat+'"]');K.selectedIndex=e?e.index:F>4?F:Math.min(F,2),K.dispatchEvent(ot),delete tt.fields,Pt(chrome.i18n.getMessage("statusProfilesSaved"),0)}))}else Ve.textContent&&(mt("fields")?Ve.textContent=ht.msg:Pt())}(),_t()}),{once:!0}),F>4&&(W.selectedIndex=F-5,W.dispatchEvent(ot),W.oldCat=K[F].value,setTimeout((function(){W.options[W.selectedIndex].scrollIntoViewIfNeeded()}),250))}function un(e,t){if(!e)return!1;var n="function"==typeof t;if(e.length>60)return alert(chrome.i18n.getMessage("statusProfileCharLimit")),n&&t(e),!1;if(/^(all|unfiled|manage\.\.\.|new\.\.\.)$/i.test(e)||0===e.indexOf(Xe)||0===e.indexOf("——"))return alert(chrome.i18n.getMessage("statusProfileReserved")),n&&t(e),!1;for(var i=A||R,s=0;s<i.length;++s)if(i[s].n===e)return alert(chrome.i18n.getMessage("statusProfileDuplicate")),n&&t(e),!1;return!0}function fn(e){e instanceof Event&&(e="");var t=(prompt(chrome.i18n.getMessage("promptProfileName")+":",e||"")||"").trim();if(un(t,fn)){var n=W.selectedIndex,i={k:"c"+J++,n:t,s:""};n<0?A.push(i):A.splice(n+1,0,i),cn(!0,i.k),W.newCat=i.k}}function gn(e){e instanceof Event&&(e="");var t=W.selectedIndex,n=(prompt(chrome.i18n.getMessage("promptNewProfileName")+":",e||A[t].n)||"").trim();n!==A[t].n&&un(n,gn)&&(A[t].n=n,cn(!0,t))}function vn(){for(var e=[],t=[],n=0;n<q.length;++n)e.push(A[q[n]]);for(n=q.length-1;n>-1;--n)A.splice(q[n],1),t.push(n);A.unshift(...e),cn(!0,t)}function hn(){for(var e,t,n=[],i=0;i<q.length;++i)e=q[i],t=A[e],A.splice(e,1),A.splice(e-1,0,t),n.push(e-1);cn(!0,n)}function mn(){for(var e,t,n=[],i=0;i<q.length;++i)e=q[i],t=A[e],A.splice(e,1),A.splice(e+1,0,t),n.push(e+1);cn(!0,n)}function pn(){for(var e=[],t=[],n=A.length,i=0;i<q.length;++i)e.push(A[q[i]]);for(i=q.length-1;i>-1;--i)A.splice(q[i],1),t.push(n-(1+i));A.push(...e),cn(!0,t)}function bn(){var e;if(confirm(chrome.i18n.getMessage("confirmProfileDelete"))){for(var t=q.length-1;t>-1;--t)e=q[t],G[A[e].k]=A[e].s,$.push(A[e].k),A.splice(e,1);cn(!0)}}function yn(){for(var e,t,n,i=[],s=q.length-1;s>-1;--s)e=q[s],n={k:t="c"+J++,n:A[e].n+" [Copy]",s:A[e].s},A.splice(e+1,0,n),i.push(e+1+s),ln(d,e,t),ln(u,e,t);cn(!0,i),W.newCat=n.k}function En(){A.sort(Ht),cn(!0)}function kn(){var e,t;q=[];for(var n=0;n<W.options.length;++n)W.options[n].selected&&q.push(n);for(n=0;n<q.length;++n)e=q[n],t=W.options[e],ge.disabled=ve.disabled=!t,t?(ce.disabled=de.disabled=0===q[0],ue.disabled=fe.disabled=q[q.length-1]===W.options.length-1):ce.disabled=de.disabled=ue.disabled=fe.disabled=!0;re.disabled=q.length>1,he.disabled=A.length<2,W.changed&&(me.disabled=!1)}function In(e){var t,n,i,s,o,a,l,r=("string"==typeof e?e:He.value).trim(),c=De.checked,u={},g=0,v=0,h=(r.match(/^r?\d/gm)||[]).length,m=0;r&&(Pt(chrome.i18n.getMessage("statusPreparingData"),2),setTimeout((function(){if(r=(r=(r=(r=(r=r.replace(/^[ \r\n]*|[ \r\n]*$/g,"")).replace(/@@/g,"\\@\\@")).replace(/~~/g,"\\~\\~")).replace(/%%/g,"\\%\\%")).replace(/\r?\n/g,"@@"),/ ###,,/.test(r)?(r=(r=r.replace(/,(?=[^"]*"(?:[^"]*"[^"]*")*[^"]*$)/g,"~~")).replace(/@@([^"]+?,)/g,"\n$1"),s=","):/ ###\t\t/.test(r)&&(r=(r=r.replace(/\t(?=[^"]*"(?:[^"]*"[^"]*")*[^"]*$)/g,"%%")).replace(/@@([^"]+?\t)/g,"\n$1"),s="\t"),t=r.split("\n"),l=t.length,!s||0===l||t[0].split(s).length<5)return Pt(chrome.i18n.getMessage("statusImportFailed"),1),void setTimeout(Pt,4e3);c||(d={},f=1,R=[],V=1),F=U=1,ht.fields=[],a=setInterval((function(){n=t[m].split(s);for(var e=0;e<n.length;++e)(","===s||/^(".*?""[^"]*"".*?"|"[^"]+")$/.test(n[e]))&&(n[e]=n[e].replace(/^"|"$/g,""),n[e]=n[e].replace(/""/g,'"')),n[e]=n[e].replace(/%%/g,"\t"),n[e]=n[e].replace(/~~/g,","),n[e]=n[e].replace(/@@/g,"\n"),n[e]=n[e].replace(/\\%\\%/g,"%%"),n[e]=n[e].replace(/\\~\\~/g,"~~"),n[e]=n[e].replace(/\\@\\@/g,"@@");if(n[0]=n[0].toLowerCase(),/^c\d+/.test(n[0])){if(o=!1,c)for(e=0;e<R.length;++e)if(R[e].n.toLowerCase()===n[1].toLowerCase()){u[n[0]]=R[e].k,o=!0;break}o||(Pt(chrome.i18n.getMessage("statusImportingProfile",[n[1]]),2),R.push({k:c?"c"+V++:n[0],n:n[1],s:n[2],h:isNaN(parseInt(n[3]))?n[3]:""}),u[n[0]]=R[R.length-1].k),c||(V=Math.max(V,+n[0].slice(1))+1)}else if(/^r\d+/.test(n[0])||!isNaN(parseInt(n[0])))Pt(chrome.i18n.getMessage("statusImportingRule",[++g,h]),2),7===n.length&&(d[c?"r"+f++:n[0]]={t:+n[1],n:n[2],v:n[3],s:n[4],o:+n[5],c:c?u[n[6]]:n[6]},c||(++f,v=Math.max(+n[0].slice(1),h,v)),tt.fields=!0);else if(0===n[0].indexOf("advanced"))Pt(chrome.i18n.getMessage("statusImportingAdvanced"),2),i=JSON.parse(n[1]).join("\n"),ke.value=c?ke.value+"\n"+i:i,tt.advanced=!0;else if(0===n[0].indexOf("exceptions"))Pt(chrome.i18n.getMessage("statusImportingExceptions"),2),i=JSON.parse(n[1]).join("\n"),Ie.value=c?Ie.value+"\n"+i:i,tt.exceptions=!0;else if(0===n[0].indexOf("textclips"))Pt(chrome.i18n.getMessage("statusImportingTextClips"),2),i=JSON.parse(n[1]).join("\n===\n"),xe.value=c?xe.value+"\n===\n"+i:i,tt.textclips=!0;else if(0===n[0].indexOf("variables"))Pt(chrome.i18n.getMessage("statusImportingVariables"),2),i=JSON.parse(n[1]).join("\n"),we.value=c?we.value+"\n"+i:i,tt.variables=!0;else{for(var e in Te)e===n[0]&&(Pt(chrome.i18n.getMessage("statusImportingOption",[e]),2),Le[e]=Te[e].checked=+n[1]);switch(n[0]){case"attributesoff":Oe.disabled=!+n[1],Oe.value=n[2].replace(/\|/g,",");break;case"autoimport":Re.value=n[2];break;case"backup":Ne.disabled=!+n[1],Ne.value=n[2];break;case"closeinfobar":Ce.disabled=!+n[1],Ce.selectedIndex=+n[2];break;case"delay":Se.disabled=!+n[1],Se.value=n[2],_e.textContent=Se.value;break;case"sitefilters":Pe.disabled=!+n[1],Pe.selectedIndex=+n[2];break;case"voice":je.disabled=!+n[1],je.selectedIndex=+n[2]}Dt({other:Le,attributesoff:Oe.value,backup:+Ne.value,closeinfobar:Ce.selectedIndex,delay:+Se.value,sitefilters:Pe.selectedIndex,voice:je.selectedIndex})}++m===l&&(clearInterval(a),f=Math.max(f,++v),Mt("cats"),on(),Ut("all"),Et(!1,!1),Pt(chrome.i18n.getMessage("statusSettingsImported"),0))}),10)}),250))}function xn(){Re.value&&fetch(Re.value,{cache:"no-cache"}).then((function(e){e.ok?e.text().then((function(e){In(e.trim())})):alert(chrome.i18n.getMessage("statusServerError")+(e.status?" ("+e.status+")":""))})).catch((function(e){alert(chrome.i18n.getMessage("statusRequestError")+" ("+e+")")}))}function wn(){for(var e="### "+Ge.toUpperCase()+" PROFILES ###,,,,,,\nProfile ID,Name,Site,Hotkey,,,\n",t=0;t<R.length;++t)e+=R[t].k+',"'+R[t].n.replace(/"/g,'""')+'","'+R[t].s.replace(/"/g,'""')+'","'+(R[t].h||"").replace(/"/g,'""')+'",,,\n';for(var t in e+="### "+Ge.toUpperCase()+" RULES ###,,,,,,\nRule ID,Type,Name,Value,Site,Mode,Profile\n",d)e+=t+","+d[t].t+',"'+d[t].n.replace(/"/g,'""')+'","'+d[t].v.replace(/"/g,'""')+'","'+d[t].s.replace(/"/g,'""')+'",'+(void 0===d[t].o?+(d[t].t<2&&Le.overwrite):d[t].o)+","+d[t].c+"\n";e+="### "+Ge.toUpperCase()+' OPTIONS ###,,,,,,\nadvanced,"'+JSON.stringify(pe).replace(/"/g,'""')+'",,,,,\nexceptions,"'+JSON.stringify(be).replace(/"/g,'""')+'",,,,,\ntextclips,"'+JSON.stringify(ye).replace(/"/g,'""')+'",,,,,\nvariables,"'+JSON.stringify(Ee).replace(/"/g,'""')+'",,,,,',chrome.storage.local.get(["attributesoff","autoimport","backup","closeinfobar","delay","sitefilters","voice"],(function(t){if(!chrome.runtime.lastError){for(var n in Te)e+="\n"+n+","+(+Le[n]||0),t[n]?e+=","+(t[n]+"").replace(/,/g,"|")+",,,,":e+=",,,,,";He.value=e,He.select(),Pt(chrome.i18n.getMessage("statusSettingsExported"),0)}}))}function Mn(e){for(var t=e.target;t&&t!==this;t=t.parentNode)if(t.matches("select")){Zt(t.id.slice(2),null,e);break}}function Bn(e){for(var t=e.target;t&&t!==this;t=t.parentNode)if(t.matches("button")){var n=t.parentNode.parentNode,i=t.id.slice(2);switch(t.id.slice(0,1)){case"d":$t(n);break;case"e":var s=We.getElementById("v_"+i);_t('<div id="code-editor"></div>',chrome.i18n.getMessage("optionsEditValue"),void 0,"editor");const t=new CodeFlask("#code-editor",{language:"js"});t.updateCode(s.value),t.onUpdate((function(e){s.value=e,s.dispatchEvent(new KeyboardEvent("keyup"))}));break;case"m":if(!Zt(i,null,e))return;en(n)}break}}function Ln(e){var t=e.target;if("DIV"===t.nodeName)(t=Xt(t))&&t.focus();else for(;t&&t!==this;){if(t.matches("input,select,textarea")){qt(t,1),t.addEventListener("blur",(function(){qt(t,0)}),{once:!0});break}t=t.parentNode}}function Tn(e){for(var t=e.target;t&&t!==this;t=t.parentNode)if(t.matches("input,textarea")){Kt(t,e);break}}function On(e){for(var t=e.target;t&&t!==this;t=t.parentNode)if(t.matches("input,textarea")){0===e.code.indexOf("Alt")&&setTimeout((function(){t.readOnly=!1,t.blur(),t.focus()}),100),"textarea"===t.type&&qt(t,1),Zt(t.id.slice(2),t);break}}function Nn(t){if(!e){var n=t.target;"DIV"===n.nodeName&&Xt(n)}}function Cn(e){var t;return function(){var n=this,i=arguments;clearTimeout(t),t=setTimeout((function(){e.apply(n,i)}),50)}}function Sn(e){var t;if((e.ctrlKey||e.altKey||e.metaKey)&&"Control"!==e.key&&"Shift"!==e.key&&"Alt"!==e.key&&"Meta"!==e.key){if((t=X.modifier+(e.key.length>1?e.key.replace(/([A-Z])/g," $1").trim():" "===e.key?"Space":e.key.toUpperCase()))===X.hotkey)return;if(t===Ke)return alert(chrome.i18n.getMessage("statusHotkeyDuplicateGlobal")),void _n();for(var n=0;n<R.length;++n)if(R[n].h===t)return alert(chrome.i18n.getMessage("statusHotkeyDuplicate").replace(/___/,R[n].n)),void _n();X.value=X.hotkey=R[F-5].h=t,Nt("cats")}else"Backspace"===e.key&&(X.value=R[F-5].h="",X.hotkey=X.modifier=void 0,Nt("cats"));X.blur()}function _n(){setTimeout((function(){X.value=X.hotkey||""}),100)}We.addEventListener("keydown",Cn((function(e){"content-hotkey"!==We.activeElement.id&&"Escape"===e.key&&ae&&"flex"===Fe.style.display&&ae.click()}))),window.addEventListener("focus",(function(){chrome.storage.local.get(["catnow","cats","o","rules"],(function(e){chrome.runtime.lastError||(Be=e.o,F===e.catnow&&R.length===e.cats.length&&JSON.stringify(R)===JSON.stringify(e.cats)&&JSON.stringify(d)===e.rules||(Mt("fields"),Mt("cats"),At()))})),xt()})),window.addEventListener("hashchange",(function(){var e=location.hash.slice(1)||"fields";e!==We.body.id&&bt(e)})),window.addEventListener("load",(function(){if(We.querySelectorAll("[data-i18n]").forEach((function(e){var t=e.getAttribute("data-i18n"),n=chrome.i18n.getMessage(t),i=chrome.i18n.getMessage(t+"TT");n&&("search"===e.type?e.placeholder=n:e.innerHTML?e.innerHTML+=" "+n:e.innerHTML=n),i&&(e.title=i)})),We.querySelectorAll(".social-link").forEach((function(e){switch(e.id){case"facebook":e.href="https://www.facebook.com/sharer.php?u="+encodeURIComponent("https://chrome.google.com/webstore/detail/autofill/nlmmgnhgdeffjkdckmikfpnddkbbfkkk");break;case"twitter":e.href="https://twitter.com/intent/tweet?text="+encodeURIComponent(chrome.i18n.getMessage("socialMessage"+(t=1,n=8,Math.floor(Math.random()*(n-t+1)+t)))+" https://chrome.google.com/webstore/detail/autofill/nlmmgnhgdeffjkdckmikfpnddkbbfkkk")}var t,n})),We.querySelectorAll(".tt-anchor").forEach((function(e){e.addEventListener("mousemove",(function(e){$e&&"block"===$e.style.display&&l.pos(e)}))})),dt){var e=We.createElement("button"),t=We.getElementById("content-search");e.type="reset",e.title=chrome.i18n.getMessage("buttonsClearTT"),e.innerHTML="&times;",t&&(t.appendChild(e),t.addEventListener("reset",Tt))}Mt(),xt()}));export{We as D,r as W,Et as disableButtons,P as elT,j as elTB,$e as elTT,mt as err,Le as oO};
